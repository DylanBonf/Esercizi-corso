<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css">
  <style>
    *{
        box-sizing: border-box;
    }
    h5{
        width:  150px;
    }

    .cart{
        min-width: 250px;
        min-height: 250px;
    }
    
    
   
    
  </style>
    <title>Carrello</title>
</head>
<body class="bg-dark" data-bs-theme="dark">
    <header>
        <header>
          <nav class="navbar bg-dark  navbar-expand-lg mb-5" data-bs-theme="dark">
              <div class="container-fluid px-5 ">
                  <a class="navbar-brand" href="#"><img  alt="logo" style="height:4rem"></a>
                  <button
                      class="navbar-toggler"
                      type="button"
                      data-bs-toggle="collapse"
                      data-bs-target="#navbarSupportedContent"
                      aria-controls="navbarSupportedContent"
                      aria-expanded="false"
                      aria-label="Toggle navigation">
                      <span class="navbar-toggler-icon"></span>
                  </button>
                  <div class="collapse navbar-collapse" id="navbarSupportedContent">
                      <!-- imposto margine a sinistra automatico per spostare a destra il menu -->
                      <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                          <li class="nav-item">
                              <a class="nav-link active" aria-current="page" href="Frontpage.html">Home</a>
                          </li>
                          <!-- <li class="nav-item">
                              <a class="nav-link" href="#">Link</a>
                          </li> -->
                          <!-- <li class="nav-item">
                              <a class="nav-link" href="#">Pricing</a>
                          </li> -->
                          <!-- <li class="nav-item">
                              <a class="nav-link" href="#">Offerte</a>
                          </li> -->
                          <li class="nav-item Carrello">
                            <a class="nav-link" href="carrelloserver.html"><i class="bi bi-cart-fill"></i></a>
                              </li>
                              <li class="nav-item">
                                <a class="nav-link" href="#"><i class="bi bi-facebook"></i></a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#"><i class="bi bi-instagram"></i></a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#"><i class="bi bi-twitter"></i></a>
                            </li>
                          <!-- <li class="nav-item"> <a class="nav-link disabled">Disabled</a> </li> -->
                      </ul>
    
                  </div>
              </div>
          </nav>
      </header>
      <main id="main">
        <div class="container-fluid px-5 mt-5">
            <div class="row d-flex justify-content-between">
                
                <div class="col-lg-9 justify-content-between">

                    <div class="d-flex justify-content-between align-items-center mb-5">

                        <h1>Il Tuo Carrello </h1>
                        <p class="numOggetti1">0 items</p>
                        
                    </div>
                    <hr>
                    
                    <div class="cartItem " id="listaCarrello">
                        
                       
                    </div>
                    <div class="d-flex justify-content-between">
                        <!-- <button class="btn btn-danger" id="delete" >
                        Svuota carrello
                        <i class="bi bi-trash3-fill"></i>
                        </button> -->
                        <!-- <button class="btn btn-danger" id="deleteAll" >
                            Cancella articoli selezionati
                            <i class="bi bi-trash3-fill"></i>
                        </button> -->
                     </div>
                </div>
                <div class="col-lg-3 px-5">
                    <div class="mb-5">
                        <H2>Riepilogo Ordine</H2>
                        
                    </div>
                    <hr>

                    <div class="row ">

                        <div class="col-lg3 d-flex justify-content-between mb-4">
                            <h2>OGGETTI: <button class="btn btn-primary numOggetti">0</button></h2>
                            <h2 class="totale">$ 0</h2>
                        </div>
                        <div class="col-lg3 mb-3">
                            <h2>SPEDIZIONE</h2>
                            <select class="form-select form-select-lg mb-3" aria-label=".form-select-lg ">
                                <option selected>Seleziona la tua spedizione</option>
                                <option value="1">Spedizione standard- $5.00</option>
                                <option value="2">Spedizione prioritaria- $11.99</option>
                                
                              </select>
                            
                        </div>
                        <div class="col-lg3 mb-4">
                                <label for="exampleFormControlTextarea1" class="form-label"><h2>CODICE SCONTO</h2></label>
                                <textarea class="form-control" id="exampleFormControlTextarea1" rows="2"></textarea>
                                <p>Inserisci codice</p>
                              
                        </div>
                        <hr>
                        <div class="col-lg1 d-flex justify-content-between mb-5">
                            <h2>Totale:</h2>
                            <h2 class="totale">$ 0</h2>
                        </div>
                        <div>
                            <button class="btn btn-primary" id="acquista">
                                Acquista
                                <i class="bi bi-bag-fill"></i>
                            </button>
                        </div>
                        

    
                    </div>

                    


                </div>


        
        </div>
        
        
            </div>
        </div>

      </main>

      <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"
        integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous">
        </script>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.min.js"
        integrity="sha384-7VPbUDkoPSGFnVtYi0QogXtr74QeVeeIs99Qfg5YCF+TidwNdjvaKZX19NZ/e6oz" crossorigin="anonymous">
        </script>
        <script>
            let listaCarrello = document.querySelector('#listaCarrello');
            let acquista = document.querySelector('#acquista')
            
            let cancellaTutto = document.querySelector("#deleteAll");
            let totale = document.querySelectorAll(".totale");
            let numOggetti = document.querySelector(".numOggetti");
            let numOggetti1 = document.querySelector(".numOggetti1");

            
            let url = "http://localhost:3000/productsCarrello"

            fetch(url)
            .then(data =>{return data.json()})
            .then(carrello =>{
            console.log(carrello);
            recuperaItems(carrello);
            }); 
       

        function recuperaItems(carrello){
            let listaCarrello = document.querySelector("#listaCarrello");
            let totaleParz = 0;
            carrello.forEach(singoloOggetto => {
                console.log(singoloOggetto)
                listaCarrello.innerHTML += 
              `<div class="row align-items-center">
                <div class="cartImg col-lg-2 mb-5 mb-lg-0">
                                <!--    l'immagine si allarga al 100%! img-fluid si ferma alla sua dimensione intrinseca
                                   e da mobile resterebbe troppo piccola -->
                                   <img src="${singoloOggetto.image[0]}" alt="strokes" class="w-100 rounded">
                                 </div>
                                 <div class="cartTitle col-6 col-lg-3">
                                   <div><strong class="fs-5">${singoloOggetto.title}</strong></div>
                                 </div>
                                 <div class="cartCounter col-6 col-lg-3 d-flex align-items-center">
                                   <button type="button" class="btn btn-link diminuisci" id="d${0}" style="color:white">
                            		<i class="bi bi-dash-circle"></i>
                             		</button>
                                   <input type="text" value="1" style="width:3rem" class="rounded border-0 valore text-center" id="${0}">
                                   <button type="button" class="btn btn-link aumenta" id="a${0}" style="color:white" >
                             		<i class="bi bi-plus-circle"></i>
                            		</button>
                                 	</div>
                                 <div class="cartPrice col-6 col-lg-2 mt-3 mt-lg-0">
                                  <strong class="fs-5">$${singoloOggetto.prezzo}</strong>
                                 </div>
                                 <div class="cartDel col-6 col-lg-2 text-end  mt-3 mt-lg-0">
                                  <button type="button" style="color:red" class="btn btn-link delete1 " data-product="${singoloOggetto.id}"  id=""><i class="bi bi-x-circle"></i></button>
                                 </div>
                    </div>
                </div>
                <hr>`;
                totaleParz = totaleParz + singoloOggetto.prezzo;
                
                
            });
            totale[0].innerHTML = "$ "+totaleParz;
            totale[1].innerHTML = "$ "+totaleParz;
            numOggetti.innerHTML = carrello.length;
            numOggetti1.innerHTML = carrello.length +" "+"items";

            let btnEl = document.querySelectorAll(".delete1");
            console.log(btnEl[1]);


            [...btnEl].forEach(bottone=>{
            

            bottone.addEventListener("click", function(){

                let id = this.getAttribute("data-product");
                console.log(id);

                let urlPerEl = url +"/" +id;

                fetch(urlPerEl,{

                method: "DELETE",
                headers: {"Content-type" : "application/json"}
            })
            .then(data =>{
                if(data.status == 404){
                    console.log();
                }else{
                    return data.json()
                }
            })
            .then(response =>{
                console.log(response);
            })
        })
        console.log(typeof(urlPerEl));
        })


            
        };


        let btnEl = document.querySelectorAll(".delete1");
        console.log(btnEl[1]);
        [...btnEl].forEach(bottone=>{
            

            bottone.addEventListener("click", function(){

                let urlPerEl = url +"/" +2;
                fetch(urlPerEl,{

                method: "DELETE",
                headers: {"Content-type" : "application/json"}
            })
            .then(data =>{
                if(data.status == 404){
                    console.log();
                }else{
                    return data.json()
                }
            })
            .then(response =>{
                console.log(response);
            })
        })
        console.log(typeof(urlPerEl));
        })


        

        

        
       

        
        
    
        
    

        </script>
